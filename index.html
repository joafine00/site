<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GoToLinkUp (Beta Demo) - Link Shortener & QR Generator</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');

  body {
    margin: 0;
    padding: 1rem;
    font-family: 'Orbitron', monospace;
    background-color: #0b0f1a;
    color: #a0cfff;
    display: flex;
    justify-content: center;
    min-height: 100vh;
  }

  #container {
    max-width: 600px;
    width: 100%;
  }

  h1 {
    color: #61dafb;
    letter-spacing: 0.1em;
    margin-bottom: 1rem;
    text-align: center;
  }

  label {
    font-weight: 700;
  }

  input[type="text"] {
    width: 100%;
    padding: 0.5rem;
    font-size: 1rem;
    margin-top: 0.3rem;
    border-radius: 5px;
    border: none;
    background: #1c2233;
    color: #d0e7ff;
    box-sizing: border-box;
  }

  button {
    margin-top: 0.7rem;
    width: 100%;
    padding: 0.6rem;
    font-size: 1.1rem;
    font-weight: 700;
    border-radius: 5px;
    border: none;
    background-color: #4caf50;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button:hover:not(:disabled) {
    background-color: #45a049;
  }
  button:disabled {
    background-color: #2f6d2f;
    cursor: not-allowed;
  }

  #qrcode {
    margin: 1rem auto;
    text-align: center;
  }

  #shortLink, #waitMessage {
    margin-top: 1rem;
    background: #12172a;
    padding: 0.7rem;
    border-radius: 5px;
    word-break: break-word;
    text-align: center;
    font-weight: 700;
    font-size: 1.1rem;
  }

  #savedLinks {
    margin-top: 2rem;
  }
  .link-item {
    background: #12172a;
    padding: 0.5rem;
    border-radius: 5px;
    margin: 0.3rem 0;
    font-size: 0.9rem;
  }
  a {
    color: #61dafb;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }

  /* Wait page style */
  #waitPage {
    text-align: center;
    margin-top: 3rem;
    font-size: 1.3rem;
    font-weight: 700;
    color: #7efc82;
  }

  /* Hide sections by default */
  section {
    display: none;
  }

  /* Show active */
  section.active {
    display: block;
  }
</style>
</head>
<body>
  <div id="container">

    <h1>GoToLinkUp (Beta Demo)</h1>

    <!-- Generator & List -->
    <section id="mainSection" class="active">
      <label for="urlInput">Enter your URL to shorten and generate QR code:</label>
      <input type="text" id="urlInput" placeholder="https://example.com" autocomplete="off" />
      <button id="generateBtn">Generate Short Link & QR Code</button>

      <div id="qrcode"></div>

      <div id="shortLink"></div>

      <h3>Saved Short Links:</h3>
      <div id="savedLinks"></div>
    </section>

    <!-- Wait / Redirect Section -->
    <section id="waitSection">
      <div id="waitPage">
        <p>Please wait while we verify you are not a bot...</p>
        <p id="countdown">Redirecting in 5 seconds</p>
      </div>
    </section>

  </div>

<script>
  const mainSection = document.getElementById('mainSection');
  const waitSection = document.getElementById('waitSection');

  const urlInput = document.getElementById('urlInput');
  const generateBtn = document.getElementById('generateBtn');
  const qrcodeContainer = document.getElementById('qrcode');
  const shortLinkDiv = document.getElementById('shortLink');
  const savedLinksContainer = document.getElementById('savedLinks');
  const countdownEl = document.getElementById('countdown');

  // Utils
  function getQueryParam(param) {
    const params = new URLSearchParams(window.location.search);
    return params.get(param);
  }

  function generateShortCode() {
    return Math.random().toString(36).substring(2, 8);
  }

  // Save links to localStorage
  function saveLink(shortCode, originalURL) {
    let links = JSON.parse(localStorage.getItem('gotolinkup_links') || '{}');
    links[shortCode] = originalURL;
    localStorage.setItem('gotolinkup_links', JSON.stringify(links));
  }

  // Load links from localStorage and list them
  function loadLinks() {
    savedLinksContainer.innerHTML = '';
    const links = JSON.parse(localStorage.getItem('gotolinkup_links') || '{}');
    if (Object.keys(links).length === 0) {
      savedLinksContainer.innerHTML = '<p>No saved short links yet.</p>';
      return;
    }
    for (const [code, url] of Object.entries(links)) {
      const div = document.createElement('div');
      div.className = 'link-item';
      div.innerHTML = `
        <strong>${code}</strong>: <a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a><br>
        Short Link: <a href="?scode=${code}">${window.location.origin + window.location.pathname}?scode=${code}</a>
      `;
      savedLinksContainer.appendChild(div);
    }
  }

  // Generate QR code for the original URL (not the short link)
  function generateQRCode(text) {
    qrcodeContainer.innerHTML = '';
    QRCode.toCanvas(qrcodeContainer, text, { width: 200 }, function (error) {
      if (error) console.error(error);
    });
  }

  // Main generator flow
  generateBtn.addEventListener('click', () => {
    const url = urlInput.value.trim();
    if (!url) {
      alert('Please enter a valid URL!');
      return;
    }
    const shortCode = generateShortCode();
    saveLink(shortCode, url);
    generateQRCode(url);
    shortLinkDiv.innerHTML = `
      Short link: <a href="?scode=${shortCode}">${window.location.origin + window.location.pathname}?scode=${shortCode}</a>
      <br><small>Note: QR code is for the original URL only.</small>
    `;
    loadLinks();
    urlInput.value = '';
  });

  // Wait page + redirect logic
  function waitAndRedirect(shortCode) {
    mainSection.classList.remove('active');
    waitSection.classList.add('active');

    const links = JSON.parse(localStorage.getItem('gotolinkup_links') || '{}');
    const originalURL = links[shortCode];

    if (!originalURL) {
      waitSection.innerHTML = '<p style="color:#ff6b6b; font-weight:700; text-align:center;">Invalid or expired link code.</p>';
      return;
    }

    let secondsLeft = 5;
    countdownEl.textContent = `Redirecting in ${secondsLeft} seconds`;

    const interval = setInterval(() => {
      secondsLeft--;
      if (secondsLeft > 0) {
        countdownEl.textContent = `Redirecting in ${secondsLeft} seconds`;
      } else {
        clearInterval(interval);
        // Redirect to original URL
        window.location.href = originalURL;
      }
    }, 1000);
  }

  // On page load
  const scode = getQueryParam('scode');
  if (scode) {
    // Show wait page with redirect
    waitAndRedirect(scode);
  } else {
    // Show main UI
    mainSection.classList.add('active');
    waitSection.classList.remove('active');
    loadLinks();
  }
</script>

</body>
</html>
